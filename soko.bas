10 REM"Sokoban in minibasic"
20 DATA".&-$# ":DIMC(6):FORI=1;6:READC(I):NEXTI
30 DATA"1",19,11
31 DATA5,5,5,5,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5
32 DATA5,5,5,5,4,0,0,0,4,5,5,5,5,5,5,5,5,5,5
33 DATA5,5,5,5,4,1,0,0,4,5,5,5,5,5,5,5,5,5,5
34 DATA5,5,4,4,4,0,0,1,4,4,5,5,5,5,5,5,5,5,5
35 DATA5,5,4,0,0,1,0,1,0,4,5,5,5,5,5,5,5,5,5
36 DATA4,4,4,0,4,0,4,4,0,4,5,5,5,4,4,4,4,4,4
37 DATA4,0,0,0,4,0,4,4,0,4,4,4,4,4,0,0,2,2,4
38 DATA4,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,2,2,4
39 DATA4,4,4,4,4,0,4,4,4,0,4,6,4,4,0,0,2,2,4
40 DATA5,5,5,5,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4
41 DATA5,5,5,5,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5
1000 L=1:GOSUB1100
1010 GOTO1400
1100 REM"Load level"
1105 RESTORE
1106 READX:IFX#L+48;GOTO1106
1110 READW,H
1115 DIMM(W,H)
1120 FORY=1;H
1130 FORX=1;W
1140 READT
1150 IFT=6;O=X:V=Y:T=0
1155 M(X,Y)=T
1160 NEXTX
1170 NEXTY
1175 N=0
1180 RETURN
1200 REM"Print level"
1210 CLS
1215 PRINT"Level ";L;" - ";N;" moves"
1220 FORY=1;H
1230 FORX=1;W
1240 PUTC(M(X,Y)+1)
1250 NEXTX
1260 PRINT
1270 NEXTY
1280 POSO,V+1:PRINT"@";:POSO,V+1
1290 RETURN
1300 REM"Move player"
1305 M=0
1310 D=O+X:E=V+Y
1320 T=M(D,E)
1330 IFT%2=1;B=M(D+X,E+Y):IFB#4;IFB%2#1;GOTO1350
1340 IFT=0;GOTO1360
1345 RETURN
1350 M(D,E)=T-1:M(D+X,E+Y)=B+1
1360 O=D:V=E:M=1:RETURN
1400 REM"Game loop"
1410 GOSUB1200
1420 GETK
1425 X=0:Y=0
1430 IFK="h";X=-1
1435 IFK="j";Y=1
1440 IFK="k";Y=-1
1445 IFK="l";X=1
1460 IFY*2+X=0;GOTO1420
1465 GOSUB1300
1470 IFM=0;GOTO1420
1480 N=N+1
1490 FORX=1;W:FORY=1;H
1500 IFM(X,Y)=2;GOTO1410
1510 NEXTY:NEXTX
1520 GOSUB1200
1530 POS1,H+2:PRINT"You win!"
